---
title: Unity6 霧めいた表現
author: zhangyile
date: 2025-08-20 09:42:00 +0800
categories: [Work Log]
tags: [Work,Development]
comments: false
img_path: /assets/img/
image:
  path: company_without/fog1.jpg
  lqip: data:image/webp;base64,UklGRpoAAABXRUJQVlA4WAoAAAAQAAAADwAABwAAQUxQSDIAAAARL0AmbZurmr57yyIiqE8oiG0bejIYEQTgqiDA9vqnsUSI6H+oAERp2HZ65qP/VIAWAFZQOCBCAAAA8AEAnQEqEAAIAAVAfCWkAALp8sF8rgRgAP7o9FDvMCkMde9PK7euH5M1m6VWoDXf2FkP3BqV0ZYbO6NA/VFIAAAA
  alt: Responsive rendering of Chirpy theme on multiple devices.
---

Unity6 6000.0.32f1
URP 17.0.3

## 前提

現在　制作しているゲームの売りにするのは奥行きなので
先にどのような敵と戦うかや風景が見えるかという動機をプレイヤーにつけるのは一番重要だと思っています。
そして　簡単に言えば　先にぼんやりに見える感じのは一番重要です。
ぼんやり表現における幾つ手段があります。

1. [**先の景色がぼかし**][depthoffield]
2. 霧でぼんやり感じを作る

## 表現
![Desktop View](company_without/fog1.jpg){: width="642" height="425" .w-75 .normal}

## 調整パラメーター
![Desktop View](company_without/fog2.jpg){: width="642" height="425" .w-75 .normal}

## 試行錯誤した結果

1. 次のフレームが影響されないように他のテクスチャを用意しておくべきです

```csharp
var cameraColorDesc = renderGraph.GetTextureDesc(resourcesData.cameraColor);
cameraColorDesc.name = "_CameraColorCustomPostProcessing";
cameraColorDesc.clearBuffer = false;
renderGraph.CreateTextureIfInvalid(cameraColorDesc,ref destination);
//今回の処理結果を新規テクスチャに保存する
builder.SetRenderAttachment(destination, 0, AccessFlags.Write);
```

2. PostProcess処理中でShaderCode中に_WorldSpaceCameraPosはゲーム世界の位置ではありません

3. 深度より、世界の位置を換算する

```
float depth = SampleSceneDepth(uv);
float3 worldPos = ComputeWorldSpacePosition(uv,depth,UNITY_MATRIX_I_VP);
```

## コードダウンロード
[**Shader.shader**][Shader]

[**RenderFeature.cs**][RenderFeature]

[**VolumeComponent.cs**][VolumeComponent]

[depthoffield]: https://zhangyile1991911.github.io/posts/depthoffield/
[Shader]: https://github.com/zhangyile1991911/UnityShowcase/blob/main/Assets/PostprocessEffect/fog/CustomDepthOfFog.shader
[RenderFeature]: https://github.com/zhangyile1991911/UnityShowcase/blob/main/Assets/PostprocessEffect/fog/PS_FogRendererFeature.cs
[VolumeComponent]: https://github.com/zhangyile1991911/UnityShowcase/blob/main/Assets/PostprocessEffect/fog/PS_FogVolumeComponent.cs